# Design: Há»“ SÆ¡ CÃ¡ NhÃ¢n (User Profile)

## API Design

### 1. GET /auth/me (Existing)

ÄÃ£ cÃ³ sáºµn, tráº£ vá» thÃ´ng tin user hiá»‡n táº¡i.

**Response:**
```json
{
  "message": "User info retrieved successfully",
  "data": {
    "accountId": 1,
    "staffId": 1,
    "username": "admin",
    "email": "admin@restaurant.com",
    "phoneNumber": "0901234567",
    "fullName": "Nguyá»…n VÄƒn Admin",
    "role": "admin",
    "isActive": true,
    "lastLogin": "2024-01-15T10:30:00Z"
  }
}
```

### 2. PUT /auth/profile (New)

Cáº­p nháº­t thÃ´ng tin profile. Chá»‰ cho phÃ©p cáº­p nháº­t cÃ¡c trÆ°á»ng khÃ´ng nháº¡y cáº£m.

**Request:**
```json
{
  "email": "newemail@example.com",
  "phoneNumber": "0909999999",
  "fullName": "Nguyá»…n VÄƒn A Updated",
  "address": "123 ÄÆ°á»ng ABC, Quáº­n 1, TP.HCM"
}
```

**Response (Success):**
```json
{
  "message": "Profile updated successfully",
  "data": {
    "accountId": 1,
    "username": "admin",
    "email": "newemail@example.com",
    "phoneNumber": "0909999999",
    "fullName": "Nguyá»…n VÄƒn A Updated",
    "address": "123 ÄÆ°á»ng ABC, Quáº­n 1, TP.HCM"
  }
}
```

**Response (Error - Duplicate):**
```json
{
  "statusCode": 409,
  "message": "Email already exists",
  "error": "Conflict"
}
```

### 3. PUT /auth/change-password (New)

Äá»•i máº­t kháº©u vá»›i xÃ¡c nháº­n máº­t kháº©u hiá»‡n táº¡i.

**Request:**
```json
{
  "currentPassword": "oldpassword123",
  "newPassword": "newpassword456"
}
```

**Response (Success):**
```json
{
  "message": "Password changed successfully"
}
```

**Response (Error - Wrong Password):**
```json
{
  "statusCode": 401,
  "message": "Current password is incorrect",
  "error": "Unauthorized"
}
```

---

## Component Design

### ProfileView Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  < Back to Dashboard           Há»“ SÆ¡ CÃ¡ NhÃ¢n             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  Nguyá»…n VÄƒn Admin                        â”‚  â”‚
â”‚  â”‚  â”‚Avatarâ”‚  admin@restaurant.com                    â”‚  â”‚
â”‚  â”‚  â”‚  NV  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â”‚  Admin   â”‚ (role badge)               â”‚  â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  ğŸ“§ THÃ”NG TIN TÃ€I KHOáº¢N                           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Username: admin                              â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Email: admin@restaurant.com                  â”‚  â”‚
â”‚  â”‚  â””â”€â”€ SÄT: 0901234567                              â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  ğŸ‘¤ THÃ”NG TIN CÃ NHÃ‚N                             â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Há» tÃªn: Nguyá»…n VÄƒn Admin                     â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ Äá»‹a chá»‰: 123 ÄÆ°á»ng ABC                       â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ NgÃ y sinh: 01/01/1990                        â”‚  â”‚
â”‚  â”‚  â””â”€â”€ NgÃ y vÃ o lÃ m: 15/01/2024                     â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â”‚  [ Chá»‰nh Sá»­a ThÃ´ng Tin ]  [ Äá»•i Máº­t Kháº©u ]        â”‚  â”‚
â”‚  â”‚                                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### EditProfileDialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chá»‰nh Sá»­a ThÃ´ng Tin               [X]       â”‚
â”‚  Cáº­p nháº­t thÃ´ng tin cÃ¡ nhÃ¢n cá»§a báº¡n          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  Email *                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ admin@restaurant.com                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  Sá»‘ Ä‘iá»‡n thoáº¡i *                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 0901234567                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  Há» vÃ  tÃªn                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Nguyá»…n VÄƒn Admin                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”‚  Äá»‹a chá»‰                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 123 ÄÆ°á»ng ABC, Quáº­n 1                â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    [ Há»§y ]  [ LÆ°u Thay Äá»•i ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ChangePasswordDialog

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Äá»•i Máº­t Kháº©u                      [X]       â”‚
â”‚  Nháº­p máº­t kháº©u hiá»‡n táº¡i Ä‘á»ƒ xÃ¡c nháº­n          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  Máº­t kháº©u hiá»‡n táº¡i *                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [ğŸ‘]   â”‚
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                              â”‚
â”‚  Máº­t kháº©u má»›i *                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [ğŸ‘]   â”‚
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚  Tá»‘i thiá»ƒu 6 kÃ½ tá»±                           â”‚
â”‚                                              â”‚
â”‚  XÃ¡c nháº­n máº­t kháº©u má»›i *                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [ğŸ‘]   â”‚
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    [ Há»§y ]  [ Äá»•i Máº­t Kháº©u ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Decisions

### 1. KhÃ´ng cho phÃ©p sá»­a Username

**Decision**: Username lÃ  read-only, khÃ´ng thá»ƒ thay Ä‘á»•i.

**Rationale**:
- Username lÃ  identifier chÃ­nh cho Ä‘Äƒng nháº­p
- Thay Ä‘á»•i username cÃ³ thá»ƒ gÃ¢y confusion
- Giá»¯ Ä‘Æ¡n giáº£n cho Ä‘á»“ Ã¡n

### 2. KhÃ´ng yÃªu cáº§u verify email má»›i

**Decision**: Email cÃ³ thá»ƒ thay Ä‘á»•i trá»±c tiáº¿p mÃ  khÃ´ng cáº§n verify.

**Rationale**:
- ÄÆ¡n giáº£n hÃ³a cho demo
- KhÃ´ng cÃ³ email service setup
- CÃ³ thá»ƒ má»Ÿ rá»™ng sau

### 3. Password minimum 6 chars

**Decision**: Chá»‰ yÃªu cáº§u tá»‘i thiá»ƒu 6 kÃ½ tá»±, khÃ´ng báº¯t buá»™c complexity.

**Rationale**:
- Äá»§ cho demo
- Giáº£m friction cho testing
- Production cÃ³ thá»ƒ nÃ¢ng cao hÆ¡n

### 4. Revoke tokens khi Ä‘á»•i password

**Decision**: KHÃ”NG revoke tokens khi Ä‘á»•i máº­t kháº©u.

**Rationale**:
- User váº«n Ä‘ang Ä‘Äƒng nháº­p, khÃ´ng muá»‘n bá»‹ logout
- Náº¿u muá»‘n logout táº¥t cáº£ devices, cÃ³ endpoint /logout-all riÃªng
- ÄÆ¡n giáº£n hÃ³a implementation

### 5. Single Card Layout

**Decision**: Sá»­ dá»¥ng single card layout thay vÃ¬ multiple sections.

**Rationale**:
- ThÃ´ng tin khÃ´ng nhiá»u, khÃ´ng cáº§n chia nhá»
- Cleaner UI
- Responsive tá»‘t hÆ¡n

---

## File Structure

```
app/client/src/modules/admin/profile/
â”œâ”€â”€ index.ts                    # Barrel export
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ProfileInfoCard.tsx     # Main info display
â”‚   â”œâ”€â”€ EditProfileDialog.tsx   # Edit form dialog
â”‚   â””â”€â”€ ChangePasswordDialog.tsx # Change password dialog
â”œâ”€â”€ views/
â”‚   â””â”€â”€ ProfileView.tsx         # Main view with layout
â”œâ”€â”€ services/
â”‚   â””â”€â”€ profile.service.ts      # API calls
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useProfile.ts           # React hooks
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts                # TypeScript types
â””â”€â”€ utils/
    â””â”€â”€ validation.ts           # Zod schemas
```

---

## Integration Points

### Auth Store

Cáº­p nháº­t `authStore` sau khi update profile Ä‘á»ƒ UI reflect changes ngay láº­p tá»©c:

```typescript
// After successful profile update
authStore.setUser({
  ...currentUser,
  email: newEmail,
  fullName: newFullName,
  // ...
});
```

### UserMenu Sync

UserMenu component Ä‘á»c tá»« authStore, sáº½ tá»± Ä‘á»™ng update khi store thay Ä‘á»•i.

---

## Error Handling

| Error | Status Code | User Message (VI) |
|-------|-------------|-------------------|
| Email exists | 409 | Email Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng |
| Phone exists | 409 | Sá»‘ Ä‘iá»‡n thoáº¡i Ä‘Ã£ Ä‘Æ°á»£c sá»­ dá»¥ng |
| Wrong password | 401 | Máº­t kháº©u hiá»‡n táº¡i khÃ´ng Ä‘Ãºng |
| Server error | 500 | CÃ³ lá»—i xáº£y ra, vui lÃ²ng thá»­ láº¡i |

---

## Open Questions

- [ ] **Q**: CÃ³ cáº§n thÃªm avatar upload khÃ´ng?
  - **A**: ChÆ°a - Ä‘á»ƒ trong out of scope

- [ ] **Q**: CÃ³ cáº§n date picker cho ngÃ y sinh khÃ´ng?
  - **A**: NgÃ y sinh lÃ  read-only trong profile (chá»‰ admin má»›i sá»­a Ä‘Æ°á»£c qua staff management)

